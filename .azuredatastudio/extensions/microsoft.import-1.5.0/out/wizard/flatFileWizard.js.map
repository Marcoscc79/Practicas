{"version":3,"file":"flatFileWizard.js","sourceRoot":"../../src","sources":["wizard/flatFileWizard.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the Source EULA. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as azdata from 'azdata';\nimport * as vscode from 'vscode';\nimport { FlatFileProvider } from '../services/contracts';\nimport { ImportDataModel } from './api/models';\nimport { ImportPage } from './api/importPage';\n// pages\nimport { FileConfigPage } from './pages/fileConfigPage';\nimport { ProsePreviewPage } from './pages/prosePreviewPage';\nimport { ModifyColumnsPage } from './pages/modifyColumnsPage';\nimport { SummaryPage } from './pages/summaryPage';\nimport * as constants from '../common/constants';\n\nexport class FlatFileWizard {\n\tprivate readonly provider: FlatFileProvider;\n\tpublic wizard: azdata.window.Wizard;\n\tpublic page1: azdata.window.WizardPage;\n\tpublic page2: azdata.window.WizardPage;\n\tpublic page3: azdata.window.WizardPage;\n\tpublic page4: azdata.window.WizardPage;\n\n\tpublic createDerivedColumnButton: azdata.window.Button;\n\tprivate importAnotherFileButton: azdata.window.Button;\n\n\tconstructor(\n\t\tprovider: FlatFileProvider,\n\t) {\n\t\tthis.provider = provider;\n\t}\n\n\tpublic async start(p: any, ...args: any[]) {\n\t\tlet model = {} as ImportDataModel;\n\n\t\tlet profile = p?.connectionProfile as azdata.IConnectionProfile;\n\t\tif (profile) {\n\t\t\tmodel.serverId = profile.id;\n\t\t\tmodel.database = profile.databaseName;\n\t\t}\n\n\t\tlet pages: Map<number, ImportPage> = new Map<number, ImportPage>();\n\n\t\tlet connectionId: string = await this.getConnectionId();\n\n\t\tif (!connectionId) {\n\t\t\treturn;\n\t\t}\n\n\t\tmodel.serverId = connectionId;\n\n\t\tthis.wizard = azdata.window.createWizard(constants.wizardNameText);\n\t\tthis.page1 = azdata.window.createWizardPage(constants.page1NameText);\n\t\tthis.page2 = azdata.window.createWizardPage(constants.page2NameText);\n\t\tthis.page3 = azdata.window.createWizardPage(constants.page3NameText);\n\t\tthis.page4 = azdata.window.createWizardPage(constants.page4NameText);\n\n\t\tlet fileConfigPage: FileConfigPage;\n\n\t\tthis.page1.registerContent(async (view) => {\n\t\t\tfileConfigPage = new FileConfigPage(this, this.page1, model, view, this.provider);\n\t\t\tpages.set(0, fileConfigPage);\n\t\t\tawait fileConfigPage.start().then(() => {\n\t\t\t\tfileConfigPage.setupNavigationValidator();\n\t\t\t\tfileConfigPage.onPageEnter();\n\t\t\t});\n\t\t});\n\n\t\tlet prosePreviewPage: ProsePreviewPage;\n\t\tthis.page2.registerContent(async (view) => {\n\t\t\tprosePreviewPage = new ProsePreviewPage(this, this.page2, model, view, this.provider);\n\t\t\tpages.set(1, prosePreviewPage);\n\t\t\tawait prosePreviewPage.start();\n\t\t});\n\n\t\tlet modifyColumnsPage: ModifyColumnsPage;\n\t\tthis.page3.registerContent(async (view) => {\n\t\t\tmodifyColumnsPage = new ModifyColumnsPage(this, this.page3, model, view, this.provider);\n\t\t\tpages.set(2, modifyColumnsPage);\n\t\t\tawait modifyColumnsPage.start();\n\t\t});\n\n\t\tlet summaryPage: SummaryPage;\n\n\t\tthis.page4.registerContent(async (view) => {\n\t\t\tsummaryPage = new SummaryPage(this, this.page4, model, view, this.provider);\n\t\t\tpages.set(3, summaryPage);\n\t\t\tawait summaryPage.start();\n\t\t});\n\n\t\tthis.createDerivedColumnButton = azdata.window.createButton(constants.createDerivedColumn);\n\t\tthis.createDerivedColumnButton.hidden = true;\n\n\t\tthis.importAnotherFileButton = azdata.window.createButton(constants.importNewFileText);\n\t\tthis.importAnotherFileButton.onClick(() => {\n\t\t\t//TODO replace this with proper cleanup for all the pages\n\t\t\tthis.wizard.close();\n\t\t\tpages.forEach((page) => page.cleanup());\n\t\t\tthis.wizard.open();\n\t\t});\n\n\t\tthis.importAnotherFileButton.hidden = true;\n\t\tthis.wizard.customButtons = [this.importAnotherFileButton, this.createDerivedColumnButton];\n\t\tthis.wizard.onPageChanged(async (event) => {\n\t\t\tlet newPageIdx = event.newPage;\n\t\t\tlet lastPageIdx = event.lastPage;\n\t\t\tlet newPage = pages.get(newPageIdx);\n\t\t\tlet lastPage = pages.get(lastPageIdx);\n\t\t\tif (lastPage) {\n\t\t\t\tawait lastPage.onPageLeave();\n\t\t\t}\n\t\t\tif (newPage) {\n\t\t\t\tnewPage.setupNavigationValidator();\n\t\t\t\tawait newPage.onPageEnter();\n\t\t\t}\n\t\t});\n\n\t\t//not needed for this wizard\n\t\tthis.wizard.generateScriptButton.hidden = true;\n\n\t\tthis.wizard.pages = [this.page1, this.page2, this.page3, this.page4];\n\n\t\tthis.wizard.open();\n\t}\n\n\tpublic async getConnectionId(): Promise<string> {\n\t\tlet currentConnection = await azdata.connection.getCurrentConnection();\n\n\t\tlet connectionId: string;\n\n\t\tif (!currentConnection) {\n\t\t\tlet connection = await azdata.connection.openConnectionDialog(constants.supportedProviders);\n\t\t\tif (!connection) {\n\t\t\t\tvscode.window.showErrorMessage(constants.needConnectionText);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconnectionId = connection.connectionId;\n\t\t} else {\n\t\t\tif (currentConnection.providerId !== 'MSSQL') {\n\t\t\t\tvscode.window.showErrorMessage(constants.needSqlConnectionText);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconnectionId = currentConnection.connectionId;\n\t\t}\n\t\treturn connectionId;\n\t}\n\n\tpublic setImportAnotherFileVisibility(visibility: boolean) {\n\t\tthis.importAnotherFileButton.hidden = !visibility;\n\t}\n\n\tpublic registerNavigationValidator(validator: (pageChangeInfo: azdata.window.WizardPageChangeInfo) => boolean) {\n\t\tthis.wizard.registerNavigationValidator(validator);\n\t}\n\n\tpublic changeNextButtonLabel(label: string) {\n\t\tthis.wizard.nextButton.label = label;\n\t}\n\n\n}\n"]}